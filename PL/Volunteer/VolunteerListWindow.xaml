<Window x:Class="PL.Volunteer.VolunteerListWindow"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:local="clr-namespace:PL.Volunteer"
      mc:Ignorable="d"
      Loaded="Window_Loaded"
      Closed="Window_Closed"
      Title="VolunteerListWindow" Height="640" Width="800"
      DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}"
      Background="{StaticResource WindowBackgroundBrush}">

    <Grid  Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- אזור סינון/כותרת -->
        <Border Grid.Row="0" Padding="18" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="0" Margin="0,0,0,24">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="220"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="רשימת מתנדבים" FontSize="22" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Label Content="סנן לפי:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="140"
                          ItemsSource="{Binding Source={StaticResource VolunteerSelectMenuCollectionKey}}"
                          SelectedValue="{Binding Path=VolunteerSelectMenus, Mode=TwoWay}"
                          SelectionChanged="VolunteerComboBox_SelectionChanged"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- אזור טבלה -->
        <Border Grid.Row="1" Padding="18" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="0" Margin="0,0,0,24">
            <DataGrid
            ItemsSource="{Binding Path=VolunteerList}"
            IsReadOnly="True"
            AutoGenerateColumns="False"
            RowHeaderWidth="0"
            RowHeight="40"
            HeadersVisibility="Column"
            ColumnHeaderHeight="44"
            AlternatingRowBackground="{DynamicResource RowAltBrush}"
            CanUserResizeRows="False"
            CanUserAddRows="False"
            SelectionMode="Single"
            SelectionUnit="FullRow"
            FontFamily="Calibri, Segoe UI, Arial"
            FontSize="16"
            Margin="0"
            SelectedItem="{Binding SelectedVolunteer}"
            MouseDoubleClick="lsvVolunteersList_MouseDoubleClick">
                <DataGrid.Columns>
                    <DataGridTextColumn Binding="{Binding Id}" Header="מזהה" Width="Auto"/>
                    <DataGridTextColumn Binding="{Binding Name}" Header="שם מתנדב" Width="*" />
                    <DataGridTemplateColumn Header="פעיל?" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsActive}" IsEnabled="False" HorizontalAlignment="Center" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Binding="{Binding HandledCallsCount}" Header="קריאות שטופלו" Width="Auto"/>
                    <DataGridTextColumn Binding="{Binding CancelledCallsCount}" Header="קריאות שבוטלו" Width="Auto"/>
                    <DataGridTextColumn Binding="{Binding ExpiredHandledCallsCount}" Header="קריאות שפגו בטיפול" Width="Auto"/>
                    <DataGridTemplateColumn Header="קריאה פעילה" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding CallInProgressId}" HorizontalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="Black"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CallInProgressId}" Value="{x:Null}">
                                                    <Setter Property="Text" Value="אין קריאה"/>
                                                    <Setter Property="Foreground" Value="Gray"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding CallInProgressId}">
                                                    <Setter Property="Text" Value="שגיאה"/>
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding CallInProgressId}" Value="{x:Null}">
                                                    <Setter Property="Text" Value=""/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Binding="{Binding CallInProgressType}" Header="סוג קריאה פעילה" Width="Auto"/>
                    <DataGridTemplateColumn Header="מחיקה">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="מחק" Click="btnDeleteVolunteer_click" Tag="{Binding}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- אזור כפתור הוספה -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,18,0,0">
            <Button Content="הוסף מתנדב חדש" Height="44" Width="180" Click="btnAddVolunteer_Click"/>
        </StackPanel>
    </Grid>
</Window>
