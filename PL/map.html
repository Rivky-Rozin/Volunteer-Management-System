<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>מפת מתנדב</title>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEN2RDy169n8Y1lStbo3wI07rG0tuPHQc"></script>
  <script>
    let map, directionsService, directionsRenderer;
    let volunteerMarker, callMarkers = [];

    function initMap() {
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 32.0853, lng: 34.7818 }, zoom: 12
      });
      directionsRenderer.setMap(map);
      window.external.Notify("ready");
    }

    function setVolunteerLocation(lat, lng) {
      const position = new google.maps.LatLng(lat, lng);
      if (!volunteerMarker) {
        volunteerMarker = new google.maps.Marker({
          position, map, label: "מתנדב", icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        });
      } else {
        volunteerMarker.setPosition(position);
      }
      map.setCenter(position);
    }

    function addCallMarker(lat, lng, label) {
      const marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, lng),
        map,
        label
      });
      callMarkers.push(marker);
    }

    function drawLine(lat1, lng1, lat2, lng2) {
      const line = new google.maps.Polyline({
        path: [new google.maps.LatLng(lat1, lng1), new google.maps.LatLng(lat2, lng2)],
        geodesic: true,
        strokeColor: "#FF0000",
        strokeOpacity: 1.0,
        strokeWeight: 2,
        map
      });
    }

    function showRoute(originLat, originLng, destLat, destLng, travelMode) {
      const request = {
        origin: new google.maps.LatLng(originLat, originLng),
        destination: new google.maps.LatLng(destLat, destLng),
        travelMode: google.maps.TravelMode[travelMode]
      };
      directionsService.route(request, function(result, status) {
        if (status == "OK") {
          directionsRenderer.setDirections(result);
        }
      });
    }
  </script>
</head>
<body onload="initMap()">
  <div id="map"></div>
</body>
</html>
